# 诗词鉴赏平台 - 项目需求文档（Vue.js + Supabase L.I.G.H.T.架构）

## 文档信息
- **文档版本**: v1.0
- **创建日期**: 2025-10-14
- **文档类型**: 项目需求文档
- **技术架构**: Vue.js + Supabase (L.I.G.H.T.模式)
- **编写视角**: 技术负责人/全栈架构师视角
- **目标读者**: 开发团队、产品经理、技术负责人

## 项目概述

### 项目愿景
构建一个以AI智能体为核心的现代化诗词鉴赏平台，通过L.I.G.H.T.架构模式实现诗词文化的智能化传承与创新性发展，为诗词爱好者提供个性化、沉浸式的学习体验。

### 核心价值主张
1. **智能鉴赏赋能**: AI为每位用户提供个性化诗词解读和创作指导
2. **知识图谱构建**: 建立诗词、作者、典故、意象的关联网络
3. **互动学习社区**: 构建诗词爱好者交流创作的数字空间
4. **文化传承创新**: 通过技术手段活化传统文化资源
5. **多模态体验**: 结合文字、音频、图像的全方位诗词展示

## 系统架构设计-基于"灯塔"(L.I.G.H.T.)架构模式

### 核心哲学
以最少的后端、最强的前端智能、Git驱动的工程协作、可弹性伸缩的数据层与模板化的AI智能体，交付一个安全、可观测、成本可控的智能诗词平台。

### 技术架构特点
- **Monorepo统一管理**: 将前端Vue.js应用、Supabase配置、AI工作流统一管理
- **Serverless优先**: 采用Supabase Edge Functions实现业务逻辑
- **AI编排核心**: 使用n8n工作流引擎协调各级AI智能体
- **Supabase中心**: PostgreSQL + pgvector构建诗词知识库
- **智能化前端**: Vue 3 + Composition API提供响应式AI交互体验

## 三级AI智能体架构(T:Templated AI Agents)

### 1. 平台级AI智能体(Platform AI)
**角色定位**: 平台的"智能馆长"或"文化策展AI"

**核心职责(监督者Agent)**
- 全局内容洞察: 分析用户阅读偏好、热门题材、地域分布
- 知识图谱优化: 自动发现诗词关联，完善作者-作品-时代关系网
- 内容质量监控: 识别低质内容、重复内容，维护平台内容生态
- 趋势预测预警: 预测诗词热点趋势，为内容运营提供数据支持
- 资源调度优化: 基于访问模式优化AI资源分配和缓存策略

**输入信息**
- 所有"鉴赏级AI"的汇总报告和分析洞察
- 用户行为数据、搜索热点、收藏模式
- 外部诗词数据库、学术研究动态
- 文化政策导向、社会热点事件

**输出信息**
- 平台运营周报、内容健康度仪表盘
- 知识图谱优化建议、内容运营策略
- 对下级AI的宏观指导原则

### 2. 鉴赏级AI智能体(Appreciation AI)
**角色定位**: 用户的"专业诗词导师"与"鉴赏顾问"

**核心职责(监督者Agent/工作者Agent)**
- 深度诗词解析: 提供多维度诗词赏析（意境、格律、修辞、典故）
- 个性化推荐: 基于用户偏好推荐相关诗词和解读内容
- 创作指导辅助: 为用户诗词创作提供格律检查、意境建议
- 知识问答服务: 解答诗词背景、作者生平、文化典故等问题
- 学习路径规划: 为用户制定个性化的诗词学习路线

**输入信息**
- 用户查询历史、收藏记录、互动行为
- 诗词数据库、学术资料、研究论文
- 用户设定的学习目标和兴趣偏好
- 来自"平台级AI"的内容策略指导

**输出信息**
- 个性化诗词推荐列表
- 深度鉴赏分析报告
- 学习进度评估和建议
- 创作辅导和修改意见

### 3. 交互级AI智能体(Interaction AI)
**角色定位**: 每个用户的"专属诗词伙伴"

**核心职责(工作者Agent)**
- 实时对话交互: 自然语言问答，理解用户诗词相关查询
- 多模态内容生成: 生成诗词配图、朗读音频、意境可视化
- 学习进度跟踪: 记录用户学习轨迹，提供学习提醒和激励
- 情感化交流: 根据用户情绪状态调整交流方式和内容
- 即时创作辅助: 提供即时的格律检查、韵脚建议

**输入信息**
- 用户实时对话内容、语音输入
- 个人学习历史、偏好设置
- 当前学习上下文和会话状态
- 来自"鉴赏级AI"的学习任务指导

**输出信息**
- 即时问答响应
- 个性化学习提醒
- 多模态内容生成结果
- 学习进度反馈和鼓励

## 数据流设计(H:Hyper-scalable Data)

### 数据流向图
```
用户操作(读者/创作者/研究者)
↓
前端(Vue.js) <=> Supabase客户端
↓
Supabase Edge Functions(API网关&鉴权)
↓
Supabase PostgreSQL(核心数据库,RLS,Realtime)
↑ ↓
Supabase Database Triggers(内生逻辑)
↓
n8n(AI编排层-平台AI/鉴赏AI/交互AI)
↓
外部LLM服务(OpenAI/文心一言/智谱AI)
↓
AI响应 → n8n处理 → Supabase更新
↓
Supabase Realtime(实时推送到前端)
```

### 关键数据表结构

#### 1. 诗词核心表(poems)
```sql
CREATE TABLE poems (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  title VARCHAR(500) NOT NULL,
  author_id UUID REFERENCES authors(id),
  dynasty VARCHAR(50) NOT NULL,
  content TEXT NOT NULL,
  rhythmic_pattern VARCHAR(200), -- 格律信息
  annotation TEXT, -- 注释
  translation TEXT, -- 译文
  appreciation TEXT, -- 赏析(AI生成)
  background TEXT, -- 创作背景
  tags TEXT[], -- 标签(题材、意境、季节等)
  difficulty_level INTEGER DEFAULT 1,
  popularity INTEGER DEFAULT 0,
  embedding VECTOR(1536), -- 向量嵌入
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 2. 作者表(authors)
```sql
CREATE TABLE authors (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  dynasty VARCHAR(50) NOT NULL,
  biography TEXT,
  literary_style TEXT, -- 文学风格
  achievements TEXT, -- 文学成就
  life_period VARCHAR(100), -- 生卒年代
  portrait_url TEXT,
  embedding VECTOR(1536),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 3. 知识图谱表(knowledge_graph)
```sql
CREATE TABLE knowledge_graph (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  source_type VARCHAR(50), -- poem/author/allusion
  source_id UUID,
  target_type VARCHAR(50),
  target_id UUID,
  relationship_type VARCHAR(100), -- 引用/影响/同主题
  weight DECIMAL(3,2) DEFAULT 1.0, -- 关系权重
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 4. 用户行为表(user_activities)
```sql
CREATE TABLE user_activities (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  activity_type VARCHAR(50), -- read/search/share/collect
  target_type VARCHAR(50), -- poem/author
  target_id UUID,
  duration INTEGER, -- 停留时长(秒)
  engagement_score INTEGER, -- 互动评分
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 数据层关键实践
- **RAG基础设施**: 使用pgvector存储诗词、作者、典故的向量嵌入，支持语义搜索
- **内生逻辑引擎**: 利用Database Triggers实现智能响应
  - 当用户频繁搜索某类诗词时，自动触发相关推荐
  - 当发现新的诗词关联时，自动更新知识图谱
  - 当内容质量异常时，触发平台AI进行内容审核
- **实时引擎**: Supabase Realtime实现用户交互的实时同步

## 用户界面设计理念(I:Intelligent Frontend)

### 设计原则
1. **文化美学**: 界面设计体现中国传统美学韵味
2. **角色化体验**: 为普通读者、创作者、研究者提供专属界面
3. **AI原生交互**: 以对话式交互为核心，降低使用门槛
4. **渐进式呈现**: 复杂信息分层展示，避免认知过载
5. **多模态融合**: 无缝整合文字、语音、图像交互

### 核心页面设计

#### 1. 智能鉴赏工作台(Smart Appreciation Dashboard)
**布局**: 三栏式设计 - 左侧导航/中间内容/右侧AI助手

**功能**:
- 个性化诗词推荐流: AI根据用户偏好动态推荐
- 智能搜索界面: 支持自然语言搜索（"找描写月亮的唐诗"）
- 诗词详情页: 多标签页展示（原文、注释、赏析、关联作品）
- 常驻AI助手: 对话式交互，支持语音输入
- 阅读进度可视化: 个人学习轨迹和成就系统

**特色**: AI根据阅读习惯调整内容呈现方式，支持深色模式阅读

#### 2. 创作辅导界面(Creation Assistant Interface)
**布局**: 创作区+指导面板+素材库

**功能**:
- 智能创作编辑器: 实时格律检查、韵脚提示
- AI创作建议: 基于输入关键词生成意境建议
- 典故引用助手: 智能推荐相关典故和化用方案
- 作品分享社区: 一键分享到平台社区
- 创作历程记录: 版本管理和修改建议

#### 3. 知识探索大屏(Knowledge Exploration Dashboard)
**布局**: 可交互的知识图谱可视化

**功能**:
- 动态知识图谱: 可视化展示诗词关联网络
- 时空分布图: 作者、作品的时空分布可视化
- 风格分析面板: 诗词风格聚类和分析
- 研究工具集: 数据导出、对比分析功能

## 性能优化策略(跨域护栏)

### 1. 数据库优化(H)
- **索引优化**: 为诗词标题、作者、朝代、标签建立复合索引
- **分区策略**: 用户行为表按时间分区
- **向量检索优化**: 使用HNSW索引加速pgvector查询
- **查询优化**: 使用Materialized View缓存复杂查询结果

### 2. AI层面优化(T&L)
- **成本感知路由**: 简单查询使用轻量模型，复杂分析使用高级模型
- **响应缓存**: 对常见问答和解析结果建立多级缓存
- **流式响应**: 实现AI响应的流式输出，降低TTFT
- **批量处理**: 对数据分析任务进行批量处理优化

### 3. 可观测性(Observability)
- **全链路追踪**: 记录从用户请求到AI响应的完整链路
- **性能监控**: 监控API响应时间、错误率、资源使用率
- **AI质量监控**: 跟踪问答准确率、用户满意度指标
- **成本监控**: 实时监控AI服务使用成本和预算执行情况

### 4. 成本控制(Cost Management)
- **智能限流**: 基于用户等级和使用场景的动态限流
- **缓存策略**:  aggressive缓存策略减少AI调用次数
- **预算警报**: 设置月度预算阈值和自动告警
- **资源回收**: 自动清理过期缓存和临时数据

## 安全与权限设计

### 1. 数据安全与隐私
- **RLS行级安全**: 
  - 用户只能访问公开内容和自己的私有数据
  - 创作者可以管理自己的作品和草稿
  - 管理员有完整的内容管理权限
- **数据脱敏**: 用户行为数据聚合分析时进行脱敏处理
- **审计日志**: 记录所有敏感操作和AI交互日志

### 2. AI安全防护
- **Prompt注入防护**: 在Edge Functions层进行输入验证和过滤
- **内容安全过滤**: 对AI生成内容进行合规性检查
- **权限控制**: 严格控制AI智能体可访问的数据范围
- **人工审核**: 对AI生成的公开内容建立人工审核机制

## 项目进度与里程碑

### 阶段一: 核心鉴赏功能MVP(3个月)
1. 基础诗词数据库建设
2. Vue.js前端框架搭建
3. 基础搜索和浏览功能
4. 交互级AI智能体(基础对话功能)
5. 用户系统和管理后台

### 阶段二: 智能能力增强(4个月)
1. 鉴赏级AI智能体深度开发
2. 知识图谱构建和可视化
3. 多模态内容生成功能
4. 社区互动功能实现
5. 移动端适配优化

### 阶段三: 平台生态完善(5个月)
1. 平台级AI智能体全面部署
2. 高级创作辅导工具
3. 数据分析和运营工具
4. API开放平台建设
5. 性能优化和体验打磨

## 成功指标与评估

### 技术指标
- 页面加载时间: <500ms (P90)
- AI响应时间: <2s (P90)
- 搜索准确率: >95%
- 系统可用性: 99.9%
- 并发用户支持: 10000+

### 业务指标
- 日活跃用户数增长趋势
- 用户平均会话时长
- 内容创作活跃度
- 用户留存率和满意度
- 知识图谱覆盖度和准确率

### 文化价值指标
- 传统文化内容传播效果
- 用户诗词学习成效提升
- 创作社区活跃度和质量
- 文化创新成果产出

---

**文档版本**: v1.0 | **最后更新**: 2025-10-14 | **技术架构**: Vue.js + Supabase (L.I.G.H.T.模式)

*注：本文档基于L.I.G.H.T.架构模式设计，充分利用现代Web技术和AI能力，打造智能化的诗词鉴赏平台。*